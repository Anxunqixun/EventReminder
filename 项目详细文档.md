# 备忘录网页端项目详细文档

## 1. 项目概述

这是一个基于Python Flask和SQLite的备忘录网页应用，提供完整的事件管理功能。用户可以创建、编辑、删除和完成事件，支持按状态筛选事件、查看过期提醒，并提供列表视图和日历视图两种展示方式。应用还实现了快速添加、操作提示等增强用户体验的功能。

## 2. 技术栈详解

### 2.1 后端技术
- **Python 3** - 核心编程语言
- **Flask** - 轻量级Web框架，用于构建RESTful API
- **Flask-CORS** - 处理跨域资源共享，支持前后端分离架构
- **SQLite** - 嵌入式数据库，用于本地存储事件数据
- **python-dateutil** - 强大的日期时间处理库，用于解析和格式化日期

### 2.2 前端技术
- **HTML5** - 构建页面结构
- **JavaScript (ES6+)** - 实现交互逻辑和API调用
- **Tailwind CSS v3** - 现代CSS框架，用于快速构建响应式UI
- **Font Awesome** - 图标库，提供丰富的UI图标

## 3. 数据库结构详解

### 3.1 数据库概述
- **数据库类型**: SQLite (轻量级文件数据库)
- **数据库文件**: events.db
- **表数量**: 1 (events表)
- **索引数量**: 1 (基于due_at字段的索引)

### 3.2 events表结构

| 字段名 | 数据类型 | 约束 | 默认值 | 描述 |
|-------|---------|------|-------|------|
| id | INTEGER | PRIMARY KEY AUTOINCREMENT | 自动递增 | 事件唯一标识符 |
| title | TEXT | NOT NULL | 无 | 事件标题（必填） |
| description | TEXT | 无 | 无 | 事件详细描述 |
| created_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | 当前时间戳 | 事件创建时间 |
| due_at | DATETIME | 无 | 无 | 事件截止时间 |
| time_hint | TEXT | 无 | 无 | 时间提示（例如：上午、下午、晚上） |
| priority | INTEGER | DEFAULT 2 | 2 | 优先级（1=高，2=中，3=低） |
| status | TEXT | DEFAULT 'active' | 'active' | 事件状态（'active'=活跃，'completed'=已完成，'deleted'=已删除） |
| last_modified | DATETIME | DEFAULT CURRENT_TIMESTAMP | 当前时间戳 | 事件最后修改时间 |

### 3.3 索引信息

| 索引名称 | 表名 | 字段 | 描述 |
|---------|------|------|------|
| idx_due_at | events | due_at | 优化按截止时间排序的查询性能 |

### 3.4 表关系
- 本系统目前只有单个表，无需表关联关系

### 3.5 数据存储说明
- 使用SQLite的DATETIME类型存储时间，格式为ISO 8601
- 状态字段使用枚举字符串值，便于查询和筛选
- 优先级使用数字表示，便于排序和比较

## 4. 项目架构与数据流

### 4.1 整体架构
```
客户端(浏览器) <---> Flask服务器 <---> SQLite数据库
```

### 3.2 模块划分

#### 后端模块
- **app.py** - Flask应用主文件，包含路由定义和业务逻辑
- **数据库操作** - 内嵌在app.py中的SQLite操作函数
- **工具函数** - 数据格式转换和辅助功能

#### 前端模块
- **index.html** - 页面结构和样式
- **script.js** - 核心交互逻辑，包含以下主要功能模块：
  - 事件管理（增删改查）
  - 视图渲染（列表视图、日历视图）
  - 用户界面交互（弹窗、筛选、搜索）
  - 通知系统
  - 数据格式化

### 3.3 数据流向
1. **数据创建/更新**：
   - 用户在前端界面操作 → JavaScript处理 → API请求 → Flask服务器 → SQLite数据库 → 返回响应

2. **数据查询**：
   - 前端加载/筛选 → API请求 → Flask服务器 → SQLite数据库查询 → 返回JSON数据 → 前端渲染

3. **状态管理**：
   - 前端维护当前视图、筛选条件、日历状态等状态变量
   - 后端维护数据库状态和事件状态

## 5. 核心功能模块详解

### 5.1 后端核心功能

#### 5.1.1 数据库初始化
```python
def init_db():
    conn = sqlite3.connect('events.db')
    cursor = conn.cursor()
    cursor.execute('''
    CREATE TABLE IF NOT EXISTS events (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        title TEXT NOT NULL,
        description TEXT,
        created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
        due_at DATETIME,
        time_hint TEXT,
        priority INTEGER DEFAULT 2,
        status TEXT DEFAULT 'active',
        last_modified DATETIME DEFAULT CURRENT_TIMESTAMP
    )
    ''')
    cursor.execute('CREATE INDEX IF NOT EXISTS idx_due_at ON events(due_at)')
    conn.commit()
    conn.close()
```
- 负责创建数据库表结构和索引
- 确保数据库在应用启动时可用

#### 4.1.2 事件CRUD操作
- **get_events()** - 获取事件列表，支持状态筛选
- **get_event()** - 获取单个事件详情
- **create_event()** - 创建新事件
- **update_event()** - 更新现有事件
- **delete_event()** - 删除事件（软删除）

#### 4.1.3 静态文件服务
- 提供前端HTML、CSS、JavaScript等静态资源

### 4.2 前端核心功能

#### 4.2.1 事件管理
- **loadEvents()** - 从API加载事件数据
- **createEventCard()** - 创建事件卡片DOM元素
- **handleFormSubmit()** - 处理事件表单提交（新增/编辑）
- **completeEvent()** - 完成或补完成事件
- **deleteEvent()** - 删除事件

#### 4.2.2 视图管理
- **toggleView()** - 切换列表视图和日历视图
- **renderCalendar()** - 渲染标准日历视图
- **renderWaterfallCalendar()** - 渲染瀑布流日历视图

#### 4.2.3 用户界面
- **showEventDetail()** - 显示事件详情弹窗
- **openAddModal()** - 打开添加事件弹窗
- **showConfirmModal()** - 显示确认操作弹窗
- **showToast()** - 显示通知消息
- **showActionToast()** - 显示操作提示

#### 4.2.4 通知系统
- 全局通知开关和分类控制
- 操作反馈和错误提示

## 6. 前端核心函数详解

### 5.1 事件处理函数

#### loadEvents()
```javascript
async function loadEvents() {
    // 从API获取事件数据，根据当前状态筛选，渲染事件列表
}
```
- **功能**：获取并显示事件列表
- **参数**：无
- **返回值**：无
- **主要流程**：
  1. 发送API请求获取事件数据
  2. 根据筛选条件过滤数据
  3. 渲染事件列表或空状态

#### handleFormSubmit(event)
```javascript
async function handleFormSubmit(event) {
    // 处理事件表单提交，新增或编辑事件
}
```
- **功能**：处理事件创建和编辑
- **参数**：event - 表单提交事件对象
- **返回值**：无
- **主要流程**：
  1. 阻止表单默认提交
  2. 获取表单数据并验证
  3. 根据是否有ID决定是新增还是更新
  4. 发送API请求并处理响应
  5. 关闭模态框并重新加载事件列表

#### completeEvent(eventId, isMakeup = false)
```javascript
async function completeEvent(eventId, isMakeup = false) {
    // 将事件标记为已完成或补完成
}
```
- **功能**：完成或补完成事件
- **参数**：
  - eventId: 事件ID
  - isMakeup: 是否为补完成操作
- **返回值**：无
- **主要流程**：
  1. 显示确认对话框
  2. 发送API请求更新事件状态
  3. 显示操作结果提示
  4. 重新加载事件列表

#### deleteEvent(eventId)
```javascript
async function deleteEvent(eventId) {
    // 删除指定事件
}
```
- **功能**：删除事件（软删除）
- **参数**：eventId - 事件ID
- **返回值**：无
- **主要流程**：
  1. 获取事件标题用于确认信息
  2. 显示确认删除对话框
  3. 发送API请求删除事件
  4. 显示操作结果提示
  5. 重新加载事件列表

### 5.2 视图渲染函数

#### createEventCard(event)
```javascript
function createEventCard(event) {
    // 创建事件卡片DOM元素，包含进度条、优先级、截止时间等信息
}
```
- **功能**：创建单个事件卡片
- **参数**：event - 事件对象
- **返回值**：DOM元素 - 事件卡片
- **主要流程**：
  1. 计算事件紧急程度和进度
  2. 创建卡片DOM结构
  3. 设置样式和交互事件
  4. 返回完整的卡片元素

#### renderCalendar()
```javascript
function renderCalendar() {
    // 渲染标准月历视图，显示当前月的事件
}
```
- **功能**：渲染标准日历视图
- **参数**：无
- **返回值**：无
- **主要流程**：
  1. 生成日历网格
  2. 标记当前日期
  3. 在对应日期显示事件标记
  4. 处理日期点击事件

#### renderWaterfallCalendar()
```javascript
function renderWaterfallCalendar() {
    // 渲染瀑布流日历视图，从当前日期开始显示多个月
}
```
- **功能**：渲染瀑布流日历视图
- **参数**：无
- **返回值**：无
- **主要流程**：
  1. 从当前日期开始生成多个月的视图
  2. 显示每个日期及其事件
  3. 处理快速添加模式

### 5.3 用户界面函数

#### showEventDetail(eventId)
```javascript
async function showEventDetail(eventId) {
    // 显示事件详情弹窗
}
```
- **功能**：显示事件详细信息
- **参数**：eventId - 事件ID
- **返回值**：无
- **主要流程**：
  1. 从API获取事件详情
  2. 格式化并显示事件信息
  3. 根据事件状态设置操作按钮

#### showToast(message, type = 'info')
```javascript
function showToast(message, type = 'info') {
    // 显示通知消息
}
```
- **功能**：显示顶部通知消息
- **参数**：
  - message: 消息内容
  - type: 消息类型（info, success, error, warning）
- **返回值**：无
- **主要流程**：
  1. 设置消息内容和图标
  2. 显示通知
  3. 定时自动隐藏

## 7. API接口详细文档

### 6.1 获取事件列表

- **URL**: `/api/v1/events`
- **方法**: `GET`
- **参数**:
  - `status`: 可选，筛选状态，值为'active'(默认), 'completed', 'deleted', 'all'
- **成功响应**:
  ```json
  [
    {
      "id": 1,
      "title": "会议",
      "description": "项目讨论",
      "created_at": "2023-12-01T08:00:00Z",
      "due_at": "2023-12-01T10:00:00Z",
      "priority": 1,
      "status": "active"
    }
  ]
  ```

### 6.2 获取单个事件

- **URL**: `/api/v1/events/<id>`
- **方法**: `GET`
- **参数**: 路径参数 `id`
- **成功响应**:
  ```json
  {
    "id": 1,
    "title": "会议",
    "description": "项目讨论",
    "created_at": "2023-12-01T08:00:00Z",
    "due_at": "2023-12-01T10:00:00Z",
    "priority": 1,
    "status": "active",
    "last_modified": "2023-12-01T08:00:00Z"
  }
  ```
- **失败响应**:
  ```json
  {"error": "Event not found"}
  ```

### 6.3 创建事件

- **URL**: `/api/v1/events`
- **方法**: `POST`
- **请求体**:
  ```json
  {
    "title": "会议",
    "description": "项目讨论",
    "due_at": "2023-12-01T10:00:00Z",
    "priority": 1,
    "time_hint": "上午"
  }
  ```
- **成功响应**:
  ```json
  {
    "id": 1,
    "title": "会议",
    "description": "项目讨论",
    "created_at": "2023-12-01T08:00:00Z",
    "due_at": "2023-12-01T10:00:00Z",
    "priority": 1,
    "status": "active",
    "time_hint": "上午"
  }
  ```
- **失败响应**:
  ```json
  {"error": "Title is required"}
  ```

### 6.4 更新事件

- **URL**: `/api/v1/events/<id>`
- **方法**: `PUT`
- **请求体**:
  ```json
  {
    "title": "更新的会议",
    "due_at": "2023-12-02T10:00:00Z",
    "status": "completed"
  }
  ```
- **成功响应**: 更新后的事件对象
- **失败响应**: 
  ```json
  {"error": "Event not found"}
  ```

### 6.5 删除事件

- **URL**: `/api/v1/events/<id>`
- **方法**: `DELETE`
- **成功响应**:
  ```json
  {"message": "Event deleted successfully"}
  ```
- **失败响应**:
  ```json
  {"error": "Event not found"}
  ```

### 6.6 获取激励语句

- **URL**: `/api/v1/getLine`
- **方法**: `GET`
- **响应**:
  ```json
  {"text": "愿你每一天都能笑容灿烂，事事顺心，天天开心。"}
  ```

## 8. 二次开发指南

### 7.1 环境设置

1. **安装依赖**:
   ```bash
   pip install -r requirements.txt
   ```

2. **启动应用**:
   ```bash
   python app.py
   ```
   应用将在 http://localhost:5001 启动

### 7.2 功能扩展建议

#### 7.2.1 后端扩展
1. **用户认证**
   - 添加用户表和认证功能
   - 实现JWT或Session认证
   - 为每个用户创建独立的事件空间

2. **数据同步**
   - 添加云同步功能
   - 实现数据备份和恢复

3. **高级功能**
   - 添加事件提醒功能（邮件、浏览器通知）
   - 实现事件分类和标签系统
   - 添加重复事件功能

#### 7.2.2 前端扩展
1. **用户界面**
   - 添加主题切换功能
   - 优化移动端响应式设计
   - 添加数据统计和可视化

2. **交互增强**
   - 实现拖拽排序功能
   - 添加批量操作功能
   - 实现离线工作模式

### 7.3 代码修改注意事项

1. **后端修改**
   - 数据库结构变更需更新`init_db()`函数
   - API修改需同步更新前端调用逻辑
   - 添加新依赖需更新`requirements.txt`

2. **前端修改**
   - 全局状态变量在script.js顶部定义，修改时需考虑全局影响
   - 事件处理函数遵循统一的命名规范
   - UI修改应保持与Tailwind CSS设计风格一致

## 9. 部署指南

### 8.1 开发环境
- 直接运行`python app.py`启动开发服务器
- 开发模式下启用了debug模式，支持热重载

### 8.2 生产环境部署

1. **使用Gunicorn**:
   ```bash
   pip install gunicorn
   gunicorn -w 4 -b 0.0.0.0:5001 app:app
   ```

2. **使用Nginx作为反向代理**:
   - 配置Nginx转发请求到应用服务器
   - 设置静态文件缓存

3. **Docker部署**:
   ```dockerfile
   FROM python:3.9
   WORKDIR /app
   COPY . .
   RUN pip install -r requirements.txt
   CMD ["gunicorn", "-w", "4", "-b", "0.0.0.0:5001", "app:app"]
   ```

## 10. 性能优化建议

### 9.1 后端优化
- 添加数据库连接池
- 优化查询性能，合理使用索引
- 实现API缓存机制

### 9.2 前端优化
- 实现事件数据的本地缓存
- 懒加载不在视图中的日历月份
- 优化DOM操作，减少重排重绘

## 11. 常见问题与解决方案

### 10.1 数据库相关
- **问题**: 数据库文件损坏
  **解决**: 删除events.db，重启应用重新创建数据库

### 10.2 API调用
- **问题**: 跨域请求失败
  **解决**: 检查CORS配置，确保允许正确的源

### 10.3 前端显示
- **问题**: 事件进度计算异常
  **解决**: 检查日期时间格式，确保正确计算时间差

## 12. 代码规范

### 11.1 Python代码规范
- 使用4空格缩进
- 遵循PEP 8规范
- 函数和变量命名使用下划线风格
- 类命名使用驼峰风格

### 11.2 JavaScript代码规范
- 使用2空格缩进
- 变量声明使用let/const
- 函数命名使用驼峰风格
- 避免使用全局变量，使用模块模式封装功能

## 13. 结语

本备忘录应用提供了完整的事件管理功能，采用了前后端分离的架构设计。通过本文档的说明，开发者应能快速了解项目结构和功能实现，为后续的功能扩展和维护提供参考。建议在进行二次开发时，遵循现有的代码规范和架构设计，确保系统的稳定性和可维护性。